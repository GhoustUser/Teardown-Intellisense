<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Teardown Mod View</title>
</head>

<body>
    <div class="container">
        <div id="mod-title" class="title">Mod Name</div>

        <div id="mod-description" class="description">Description goes here...</div>

        <div class="tags-version">
            <div class="tags">
                <input id="tags_field" type="text" placeholder="Tags (comma-separated)" />
            </div>
            <div class="version">
                <input id="version_field" type="text" placeholder="Version" />
            </div>
        </div>

        <button id="saveButton" class="save-button">Save</button>
    </div>

    <script>
        const vscode = acquireVsCodeApi();

        // Listen for messages from the extension
        window.addEventListener('message', (event) => {
            const message = event.data;
            if (message.type === 'update') {
                const content = message.text;
                const fields = parseContent(content);
                document.getElementById('mod-title').innerText = fields.name;
                document.getElementById('mod-description').innerText = fields.description;
                document.getElementById('tags_field').value = fields.tags;
                document.getElementById('version_field').value = fields.version;
            }
        });

        // Function to parse the content into fields
        function parseContent(content) {
            const lines = content.split('\n');
            const fields = { name: '', description: '', tags: '', version: '' };
            let currentField = null;

            lines.forEach(line => {
                if (line.startsWith('name = ')) {
                    fields.name = line.replace('name = ', '').trim();
                } else if (line.startsWith('description = ')) {
                    fields.description = line.replace('description = ', '').trim();
                    currentField = 'description';
                } else if (line.startsWith('tags = ')) {
                    fields.tags = line.replace('tags = ', '').trim();
                    currentField = null;
                } else if (line.startsWith('version = ')) {
                    fields.version = line.replace('version = ', '').trim();
                    currentField = null;
                } else if (currentField === 'description') {
                    fields.description += '\n' + line.trim();
                }
            });

            return fields;
        }

        // Handle the save button click
        document.getElementById('saveButton').addEventListener('click', () => {
            const fields = {
                name: document.getElementById('mod-title').innerText,
                description: document.getElementById('mod-description').innerText,
                tags: document.getElementById('tags_field').value,
                version: document.getElementById('version_field').value
            };

            const saveString = mergeContent(fields);

            vscode.postMessage({
                type: 'edit',
                text: saveString
            });
        });

        // Function to merge fields into content
        function mergeContent(fields) {
            let content = '';
            if (fields.name) content += `name = ${fields.name}\n`;
            if (fields.description) content += `description = ${fields.description}\n`;
            if (fields.tags) content += `tags = ${fields.tags}\n`;
            if (fields.version) content += `version = ${fields.version}\n`;
            return content.trim();
        }
    </script>
</body>

</html>